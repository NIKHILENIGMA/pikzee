---
title: Authentication 
description: How login feature works
category: "Feature"
---

## Onboarding User

<hr />
## Login User

<hr />
## 

### ðŸ·ï¸ Feature Overview

**Feature Name:** `e.g., User Invitation Flow`
**Module/Scope:** `e.g., Workspaces â†’ Members â†’ Invitations`
**Author:** `Your Name`
**Last Updated:** `YYYY-MM-DD`
**Status:** `Completed / In Progress / Planned`

**Short Summary:**

> Explain in one paragraph what this feature does and why it exists.
> e.g., Allows workspace admins to invite new members via email and manage their access roles.

---

### ðŸŽ¯ Feature Goals & Requirements

**Business Goals**

- Clear description of the user/business value this feature provides.

**Technical Goals**

- Define what this feature achieves technically.
- Example: â€œSyncs invitation acceptance with Clerk user creation flow.â€

**Non-Goals**

- (Optional) Clarify what the feature doesnâ€™t handle (to avoid confusion later).

---

### âš™ï¸ High-Level Flow

> Quick bullet sequence of how the feature works from frontend â†’ backend â†’ database.

```
Frontend â†’ API â†’ Backend Service â†’ Database â†’ Response â†’ UI Update
```

**Example**

1. User clicks "Invite Member" â†’ triggers modal with email & role input.
2. Frontend calls `/api/workspaces/:id/invite` via Axios.
3. Backend validates request â†’ creates invitation record â†’ sends email via Resend.
4. Invitee clicks email link â†’ frontend calls `/api/invitations/accept`.
5. Backend validates token â†’ adds member to workspace â†’ deletes invitation record.
6. Frontend redirects to workspace dashboard with success banner.

---

### ðŸ§  Architecture Flow Diagram (Sequence)

Use PlantUML / Mermaid / or Zudokuâ€™s built-in diagram block:

```mermaid
sequenceDiagram
    participant U as User (Frontend)
    participant FE as Next.js Frontend
    participant BE as NestJS Backend
    participant DB as PostgreSQL
    participant EM as Email Service (Resend)

    U->>FE: Click Invite Member
    FE->>BE: POST /api/workspaces/:id/invite
    BE->>DB: INSERT INTO invitations (...)
    BE->>EM: Send Invitation Email
    EM-->>U: Invitation Email with token link
    U->>FE: Click Accept Invitation
    FE->>BE: POST /api/invitations/accept
    BE->>DB: Verify + Update workspace_members
    BE-->>FE: 200 OK
    FE-->>U: Show Success UI
```

---

### ðŸ’» Frontend Implementation

**Location:**
`/src/features/workspaces/invite/InviteModal.tsx`
`/src/api/invite.api.ts`

**Key Hooks / Components**

- `useInviteMemberMutation`
- `InviteMemberForm`
- `ModalProvider`

**Key Libraries**

- `react-hook-form`, `zod`, `axios`, `tanstack-query`

**Flow**

1. Form validation using Zod schema
2. Call `POST /api/workspaces/:id/invite` mutation
3. On success â†’ show toast & invalidate query `workspaceMembers`

**Example Pseudo:**

```tsx
const mutation = useMutation({
  mutationFn: inviteMemberApi,
  onSuccess: () => queryClient.invalidateQueries(workspaceKeys.members()),
});
```

---

### ðŸ§° Backend Implementation

**Location:**
`/src/modules/invitations/invitations.controller.ts`
`/src/modules/invitations/invitations.service.ts`

**Key Endpoints**

- `POST /api/workspaces/:id/invite` â†’ `createInvitation()`
- `POST /api/invitations/accept` â†’ `acceptInvitation()`

**Key Functions**

- `generateInvitationToken()`
- `validateInvitationToken()`
- `addMemberToWorkspace()`

**Middleware**

- `authenticateUser`
- `attachWorkspaceContext`

**Logic Summary**

- Validate permissions â†’ only admins can invite
- Store invitation in `workspace_invitations`
- Use Resend API for email
- On acceptance, validate token & add to `workspace_members`

---

### ðŸ§¾ Database Schema (Drizzle / Prisma)

```sql
CREATE TABLE workspace_invitations (
  id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
  workspace_id UUID NOT NULL REFERENCES workspaces(id),
  email VARCHAR(255) NOT NULL,
  role VARCHAR(50) NOT NULL,
  token VARCHAR(255) UNIQUE NOT NULL,
  expires_at TIMESTAMP NOT NULL,
  created_at TIMESTAMP DEFAULT NOW(),
  updated_at TIMESTAMP DEFAULT NOW()
);
```

**Relations**

- `workspace_invitations.workspace_id â†’ workspaces.id`
- After acceptance â†’ `workspace_members.user_id â†’ users.id`

---

### ðŸ§ª Testing Notes

**Manual Testing**

- Test invite email received
- Expired token case
- Re-inviting an existing member

**Postman Collection:**
`/docs/postman/workspace-invitations.postman.json`

**Automated Tests**

- `invitations.service.spec.ts`
- `invitations.controller.spec.ts`

---

### ðŸ“¡ CI/CD & Deployment Notes

- Feature flag (if any)
- Environment variables used:

  ```
  RESEND_API_KEY=
  INVITE_TOKEN_SECRET=
  INVITE_TOKEN_EXPIRY=24h
  ```

- Migration path:

  - Run `pnpm drizzle:push` before deploying backend.

---

### ðŸ§­ Future Enhancements

- Add bulk invitations
- Add analytics for pending invites
- Add retry email for failed deliveries

---

### ðŸ“š References

- [Clerk Docs â€“ Organizations](https://clerk.com/docs/organizations)
- [Resend API â€“ Send Email](https://resend.com/docs/api-reference/emails/send)
- Internal Slack Thread: `#workspace-invitation-flow`

---

## âœ… Template Reusability Guide

When documenting new features, **duplicate this file** and just modify:

- Overview section (feature name, summary)
- Frontend, Backend, DB details
- Mermaid diagram
- CI/CD variables
- Future roadmap

---

Would you like me to format this into a **ready-to-use Zudoku `.mdx` documentation page structure** (with Tailwind classes, sections, and Zudoku syntax for collapsibles and diagrams)?
That way, you can copyâ€“paste it directly into your `/docs/features/` folder.
